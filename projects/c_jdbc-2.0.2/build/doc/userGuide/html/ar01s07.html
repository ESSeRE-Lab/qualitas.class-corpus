<html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>7.&nbsp;Administration console</title><meta content="DocBook XSL Stylesheets V1.65.1" name="generator"><link rel="home" href="index.html" title="C-JDBC User's Guide"><link rel="up" href="index.html" title="C-JDBC User's Guide"><link rel="previous" href="ar01s06.html" title="6.&nbsp;C-JDBC controller"><link rel="next" href="ar01s08.html" title="8.&nbsp;Virtual Database Console Menu"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table summary="Navigation header" width="100%"><tr><th align="center" colspan="3">7.&nbsp;Administration console</th></tr><tr><td align="left" width="20%"><a accesskey="p" href="ar01s06.html"><img src="../../images/prev.gif" alt="Prev"></a>&nbsp;</td><th align="center" width="60%">&nbsp;</th><td align="right" width="20%">&nbsp;<a accesskey="n" href="ar01s08.html"><img src="../../images/next.gif" alt="Next"></a></td></tr></table><hr></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="administration_console"></a>7.&nbsp;Administration console</h2></div></div><div></div></div><p>The C-JDBC administration console is now based on JMX technologies. The text mode
      console is a JMX client based on the standard RMI connector for JMX but you can also use a
      generic a JMX administration console through HTTP from any web browser to see all the
      MBeans registered in the cjdbc domain. The graphical console is not fully supported and
      only the text console is actively maintained.</p><p>
		You can start the graphic interface using the console.sh/.bat script.
		If your environment does not support graphic interface, it will automatically revert
		to the text console.
	  </p><div class="mediaobject" align="center"><img src="images/gui-screenshot.gif" align="middle"></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td valign="top" align="center" rowspan="2" width="25"><img alt="[Note]" src="../../images/note.gif"></td><th align="left">Note</th></tr><tr><td valign="top" align="left" colspan="2"><p>
        <span class="emphasis"><em>This section is under huge rewriting and will be put up to 
          date soon. Please, do come back and check this soon. 
          </em></span>
      </p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx_notifications"></a>7.1.&nbsp;Jmx Notifications List</h3></div></div><div></div></div><p>Here is a list of the JMX remote notifications generated by C-JDBC.</p><div class="itemizedlist"><ul type="disc"><li><p><tt class="literal">cjdbc.controller.virtualdatabases.removed</tt> a 
          virtual database has been removed.</p></li><li><p><tt class="literal">cjdbc.controller.virtualdatabase.added</tt> a 
          virtual database has been added to the controller</p></li><li><p><tt class="literal">cjdbc.virtualdatabase.dump.list</tt> the 
          list of dump files has been updated</p></li><li><p><tt class="literal">cjdbc.virtualdatabase.backend.added</tt> a backend 
          has been added to the virtual database</p></li><li><p><tt class="literal">cjdbc.distributed.controller.added</tt> a 
          controller has joined the group</p></li><li><p><tt class="literal">cjdbc.virtualdatabase.backend.disabled</tt> a 
          backend has been disabled</p></li><li><p><tt class="literal">cjdbc.virtualdatabase.backend.enabled</tt> a 
          backend has been enabled</p></li><li><p><tt class="literal">cjdbc.virtualdatabase.backend.recovering</tt> a 
          backend is recovering a dump file</p></li><li><p><tt class="literal">cjdbc.virtualdatabase.backend.recovery.failed</tt> 
          Recovery of a dump file failed</p></li><li><p><tt class="literal">cjdbc.virtualdatabase.backend.replaying.failed</tt> 
          Recovery log replay failed</p></li><li><p><tt class="literal">cjdbc.virtualdatabase.backend.backingup</tt> a 
          backend is backing up</p></li><li><p><tt class="literal">cjdbc.virtualdatabase.backend.enable.write</tt> a 
          backend is now write enabled</p></li><li><p><tt class="literal">cjdbc.virtualdatabase.backend.removed</tt> a 
          backend has been removed from the virtual database</p></li><li><p><tt class="literal">cjdbc.virtualdatabase.backend.disabling</tt> a 
          backend is now in state disabling (finishing pending transactions and 
          pending requests)</p></li><li><p><tt class="literal">cjdbc.virtualdatabase.backend.unknown</tt> The 
          backend state has been completely lost. Recovery needed</p></li><li><p><tt class="literal">cjdbc.virtualdatabase.backend.replaying</tt> a 
          backend is replaying requests from the recovery log</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="starting_console"></a>7.2.&nbsp;Starting the Administration Console</h3></div></div><div></div></div><p>The <tt class="filename">bin</tt> directory of the 
        C-JDBC distribution contains the scripts to start the console. Unix 
        users must start the console with <span><b class="command">console.sh -t</b></span> whereas 
        Windows users have to start <span><b class="command">console.bat -t</b></span>.</p><p>The console script accepts several options:</p><div class="itemizedlist"><ul type="disc"><li><p><tt class="option">-d</tt> or <tt class="option">--debug</tt>: show
          stack trace when error occurs.</p></li><li><p><tt class="option">-f</tt> or <tt class="option">--file</tt>: Use a
          given file as the source of commands instead of reading
          commands interactively.</p></li><li><p><tt class="option">-h</tt> or <tt class="option">--help</tt>:
          displays usage information.</p></li><li><p><tt class="option">-i</tt> or <tt class="option">--ip</tt>: IP
          address of the host name where the JMX Server hosting the
          controller is running (the default is '0.0.0.0').</p></li><li><p><tt class="option">-p</tt> or <tt class="option">--port</tt>:
        JMX/RMI port number of (the default is 1090).</p></li><li><p><tt class="option">-s</tt> or <tt class="option">--secret</tt>:
        Password for JMX connection.</p></li><li><p><tt class="option">-u</tt> or <tt class="option">--username</tt>:
          username for JMX connection.</p></li><li><p><tt class="option">-v</tt> or <tt class="option">--version</tt>:
          displays version information.</p></li><li><p><tt class="option">-t</tt> or <tt class="option">--text</tt>:
          force the console to start in text mode. By default, it will try to start in graphic mode
		  </p></li></ul></div><p>For example, <span><b class="command">console.sh -t -i 192.168.0.1 -p
        1234</b></span> will connect the console to the controller
        using the RMI JMX adaptor listening on port 1234 on
        <tt class="literal">192.168.0.1</tt>.</p><p>The console has an online help that is accessible by
        typing <span><b class="command">help</b></span> at any time.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="console_quickstart"></a>7.3.&nbsp;Console Quickstart</h3></div></div><div></div></div><p>Here is a quick description of the steps needed to make a 
        controller ready to serve requests:</p><div class="orderedlist"><ol type="1"><li><p>Start the controller using <span><b class="command">controller.sh</b></span> or 
            <span><b class="command">controller.bat</b></span> (see <a href="ar01s06.html#starting_controller" title="6.2.&nbsp;Starting the Controller">Section&nbsp;6.2, &ldquo;Starting the Controller&rdquo;</a>).</p></li><li><p>Start the console using <span><b class="command">console.sh -t</b></span> or 
            <span><b class="command">console.bat -t</b></span> (see <a href="ar01s07.html#starting_console" title="7.2.&nbsp;Starting the Administration Console">Section&nbsp;7.2, &ldquo;Starting the Administration Console&rdquo;</a>).</p></li><li><p>Load a configuration file using <span><b class="command">load 
            &lt;complete-path&gt;/config.xml</b></span>. The controller 
            configuration files are described in <a href="ar01s11.html" title="11.&nbsp;Virtual database configuration">Section&nbsp;11, &ldquo;Virtual database configuration&rdquo;</a>.</p></li><li><p>Connect to the virtual database with the administrator login 
            using the <span><b class="command">admin</b></span> command (see example 
            below).</p></li><li><p>Enable all backends using the <span><b class="command">enableAll</b></span> 
            command.</p></li><li><p>Come back to the main menu using the <span><b class="command">quit</b></span> 
            command.</p></li><li><p>Check the configuration using the <span><b class="command">getInfo</b></span> 
            command.</p></li></ol></div><p>Here is an example of a controller configuration and startup:</p><pre class="programlisting">
 
[emmanuel@gre-home bin]$ console.sh -t
Launching the C-JDBC controller console
Initializing Controller module...
Initializing VirtualDatabase Administration module...
Initializing Monitoring module...
Initializing SQL Console module...
C-JDBC driver (v. 2.0) successfully loaded.
  
gre-home:1090 &gt;help
Commands available for the Controller module are:
admin &lt;virtualdatabase name&gt;
   Administrate a virtual database
connect controller &lt;controller hostname&gt; &lt;jmx port&gt;
   Connect to a C-JDBC controller
drop virtualdatabase &lt;virtualdatabase name&gt;
   Drop a virtual database from the controller
help
   Print this help message
history [&lt;commandIndex&gt;]
   Display history of commands for this module
load virtualdatabase config &lt;virtualdatabase xml file&gt;
   Send a virtual database XML configuration file to the controller and load it
monitor &lt;virtualdatabase name&gt;
   Monitor a virtual database
quit
   Quit this console
reload logging configuration
   Refresh the trace system by reloading the logging configuration file
save configuration
   Save the current configuration of the virtual databases as an XML file
show controller config
   Show Controller configuration
show logging config
   Show logging configuration and the most recent traces
show virtualdatabases
   Show the names of the virtual databases for this controller
shutdown [mode]
   Shutdown the controller and all its virtual databases. Mode parameter must be:
        1 -- wait for all client connections to be closed, does not work with a connection pool
        2 -- mode safe, default value, waits for all current transactions to complete
        3 -- mode force, immediate shutdown without consistency: recovery will be needed on restart
sql client &lt;c-jdbc url&gt;
   Open a SQL client console for the virtual database specified by the C-JDBC URL
upload driver &lt;driver file&gt;
   Upload a driver to the controller

gre-home:1090 &gt; &lt;userinput&gt;show virtualdatabases&lt;/userinput&gt;
myDB
gre-home:1090 &gt; &lt;userinput&gt;admin myDB&lt;/userinput&gt;
Virtual database Administrator Login &gt; &lt;userinput&gt;admin&lt;/userinput&gt;
Virtual database Administrator Password &gt; &lt;userinput&gt;*****&lt;/userinput&gt;
Ready to administrate virtual database myDB
myDB(admin) &gt; help
Commands available for the VirtualDatabase Administration module are:
backup &lt;backend name&gt; &lt;dump name&gt; &lt;backuper name&gt; &lt;path&gt; [&lt;tables&gt;]
   Backup a backend into a dump file and associate a checkpoint with this dump
delete dump &lt;dump name&gt;
   Delete a dump
disable &lt;backend name | *&gt;
   Disable the specified backend and automatically set a checkpoint
        * means that all backends of this virtual database must be disabled
enable &lt;backend name | *&gt;
   Enable the specified backend
        * means that all backends of this virtual database must be enabled
expert &lt;on|off&gt;
   Switch to expert mode (commands for advanced users are available)
help
   Print this help message
history [&lt;commandIndex&gt;]
   Display history of commands for this module
quit
   Quit this console
restore &lt;backend name&gt; &lt;dump name&gt; [&lt;tables&gt;]
   Starts the recovery process of the given backend for a given dump name
show backend &lt;backend name | *&gt;
   Show information on backend of this virtual database
        * means to show information for all the backends of this virtual database
show backends
   Show the names of the backends of this virtual database on the current controller
show backupers
   Show the backupers available for backup
show controllers
   Show the names of the controllers hosting this virtual database
show dumps
   Show all dumps available for database recovery
show virtualdatabase config
   Show the XML configuration of the virtual database
transfer dump &lt;dump name&gt; &lt;controller name&gt; [nocopy]
   Make a dump available for restore on another controller.
Optional 'nocopy' (default: false) flag specifies not to copy the dump.

myDB(admin) &gt; &lt;userinput&gt;show backend *&lt;/userinput&gt;
+--------------------------+-----------------------------------+
| Backend Name             | localhost                         |
| Driver                   | org.hsqldb.jdbcDriver             |
| URL                      | jdbc:hsqldb:hsql://localhost:9001 |
| Active transactions      | 0                                 |
| Pending Requests         | 0                                 |
| Read Enabled             | true                              |
| Write Enabled            | true                              |
| Is Initialized           | true                              |
| Static Schema            | false                             |
| Connection Managers      | 1                                 |
| Total Active Connections | 5                                 |
| Total Requests           | 0                                 |
| Total Transactions       | 0                                 |
| Last known checkpoint    | &lt;unknown&gt;                         |
+--------------------------+-----------------------------------+
| Backend Name             | localhost2                        |
| Driver                   | org.hsqldb.jdbcDriver             |
| URL                      | jdbc:hsqldb:hsql://localhost:9002 |
| Active transactions      | 0                                 |
| Pending Requests         | 0                                 |
| Read Enabled             | true                              |
| Write Enabled            | true                              |
| Is Initialized           | true                              |
| Static Schema            | false                             |
| Connection Managers      | 1                                 |
| Total Active Connections | 5                                 |
| Total Requests           | 0                                 |
| Total Transactions       | 0                                 |
| Last known checkpoint    | &lt;unknown&gt;                         |
+--------------------------+-----------------------------------+

      </pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="console_main_menu"></a>7.4.&nbsp;Console Main Menu</h3></div></div><div></div></div><p>The graphical version of the console provides a shell-like history 
        (more precisely a tcsh-like behavior). You can recall a previous 
        command by using the arrow keys (up and down) to browse the history. If 
        you prefix a command by <tt class="literal">!</tt>, the console will browse 
        the history and complete the command with the latest command in the 
        history starting with the command prefix (completion occurs when you 
        press the tab key). In the graphical version, you can also access all 
        the commands of the different module using the right button of the 
        mouse. </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td valign="top" align="center" rowspan="2" width="25"><img alt="[Note]" src="../../images/note.gif"></td><th align="left">Note</th></tr><tr><td valign="top" align="left" colspan="2"><p>All the commands issued can also be recalled using the history 
          menu in the contextual menu that appears on a right-button 
          click.</p></td></tr></table></div><p>Commands available from the console main menu are:</p><div class="itemizedlist"><ul type="disc"><li><p><span><b class="command">admin &lt;virtualdatabase name&gt;</b></span>: Administrate a virtual database</p></li><li><p><span><b class="command">connect controller &lt;controller hostname&gt; &lt;jmx port&gt;</b></span>: connect to a C-JDBC controller</p></li><li><p><span><b class="command">drop virtualdatabase &lt;virtualdatabase name&gt;</b></span>: Drop a virtual database from the controller</p></li><li><p><span><b class="command">help</b></span>:  Print this help message</p></li><li><p><span><b class="command">history [&lt;commandIndex&gt;]</b></span>:  Display history of commands for this module</p></li><li><p><span><b class="command">load virtualdatabase config &lt;virtualdatabase xml file&gt;</b></span>: Send a virtual database XML 
          configuration file to the controller and load it</p></li><li><p><span><b class="command">monitor &lt;virtualdatabase name&gt;</b></span>: Monitor a virtual database</p></li><li><p><span><b class="command">quit</b></span>: Quit this console</p></li><li><p><span><b class="command">reload logging configuration</b></span>: Refresh the trace system by reloading the logging configuration file</p></li><li><p><span><b class="command">save configuration</b></span>: Save the current configuration of the virtual databases as an XML file</p></li><li><p><span><b class="command">show controller config</b></span>: Show Controller configuration</p></li><li><p><span><b class="command">show logging config</b></span>: Show logging configuration and the most recent traces</p></li><li><p><span><b class="command">show virtualdatabases</b></span>: Show the names of the virtual databases for this controller</p></li><li><p><span><b class="command">shutdown [<tt class="literal">mode</tt>]</b></span>: shutdown 
            the controller and all its virtual databases.</p><p>Three shutdown modes are provided. If not specified, the 
            default mode is the shutdown mode immediate.</p><div class="itemizedlist"><ul type="circle"><li><p>Shutdown mode wait (mode <tt class="literal">1</tt>): wait for 
                all client connections to be closed, does not work if the 
                client uses a connection pool with persistent 
                connections.</p></li><li><p>Shutdown mode safe (mode <tt class="literal">2</tt>): default 
                value, waits for all current transactions to complete before 
                shutting down. transaction and shutdown.</p></li><li><p>Shutdown mode force (mode <tt class="literal">3</tt>): does not 
                wait for transactions completion and kill all connections. 
                Backends are disabled without consistency and a full recovery 
                will be needed on restart.</p></li></ul></div><p>E.g: <span><b class="command">shudown 2</b></span>.</p></li><li><p><span><b class="command">sql client &lt;c-jdbc url&gt;</b></span>: Open a SQL client console for the virtual database specified by the 
          C-JDBC URL</p></li><li><p><span><b class="command">upload driver &lt;driver file&gt;</b></span>: Upload a driver to the controller</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="administrator_menu"></a>7.5.&nbsp;Administrator Menu</h3></div></div><div></div></div><p>Once the configuration file has been loaded on the controller, all 
        backends are in the disabled state. You must enable them all or one by 
        one to allow them to execute requests. C-JDBC does not check that 
        database contents are synchronized and you must ensure that all 
        backends are in a coherent state prior to starting the controller. To 
        ensure that backends remain synchronized on startup, you must use 
        checkpoints (see <a href="ar01s06.html#understanding_checkpoints" title="6.5.2.&nbsp;Understanding checkpoints">Section&nbsp;6.5.2, &ldquo;Understanding checkpoints&rdquo;</a>).</p><p>If you properly shutdown the controller using the wait or safe 
          mode, database backend states are properly recorded and their state 
          is automatically restored when they are enabled.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="administrator_standard_commands"></a>7.5.1.&nbsp;Administrator Standard Commands</h4></div></div><div></div></div><p>Standard commands available from the console administrator menu are:</p><div class="itemizedlist"><ul type="disc"><li><p><span><b class="command">backup &lt;backend name&gt; &lt;dump name&gt; &lt;backuper
            name&gt; &lt;path&gt; [&lt;tables&gt;]</b></span>: Backup a backend into a
            dump file and associate a checkpoint with this dump. Note that the console will
            ask for a login and password to connect to the backend to backup. This is specific
            to the Backuper that you are using but this should usually be a valid
            login/password on the database engine that you are backuping. The login must be
            granted access on all tables from the controller node.</p></li><li><p><span><b class="command">delete dump &lt;dump name&gt;</b></span>: Delete a dump</p></li><li><p><span><b class="command">disable &lt;backend name | *&gt;
            &lt;checkpoint&gt;</b></span>: Disable the specified backend and store the
            given checkpoint (* means that all backends of this virtual database must be
            disabled)</p></li><li><p><span><b class="command">enable &lt;backend name | *&gt;</b></span>: Enable the
            specified backend from its last known checkpoint (* means that all backends of
            this virtual database must be enabled)</p></li><li><p><span><b class="command">expert &lt;on|off&gt;</b></span>: Switch to expert mode
            (commands for advanced users are available)</p></li><li><p><span><b class="command">help</b></span>: Print this help message</p></li><li><p><span><b class="command">history [&lt;commandIndex&gt;]</b></span>: Display history
            of commands for this module</p></li><li><p><span><b class="command">quit</b></span>: Quit this console</p></li><li><p><span><b class="command">restore &lt;backend name&gt; &lt;dump name&gt;
            [&lt;tables&gt;]</b></span>: Starts the recovery process of the given backend
            using the given dump name. Note that the console will ask for a login and password
            to connect to the backend to restore This is specific to the Backuper that you are
            using but this should usually be a valid login/password (real login in the C-JDBC
            terminology) on the database engine that you are restoring. Note that this login
            must be granted the right to create new databases and tables.</p></li><li><p><span><b class="command">show backend &lt;backend name | *&gt;</b></span>: Show
            information on backend of this virtual database (* means to show information for
            all the backends of this virtual database) </p></li><li><p><span><b class="command">show backends</b></span>: Show the names of the backends of this
            virtual database on the current controller </p></li><li><p><span><b class="command">show backupers</b></span>: Show the backupers available for
            backup</p></li><li><p><span><b class="command">show controllers</b></span>: Show the names of the controllers
            hosting this virtual database</p></li><li><p><span><b class="command">show dumps</b></span>: Show all dumps available for database
            recovery</p></li><li><p><span><b class="command">show virtualdatabase config</b></span>: Show the XML
            configuration of the virtual database</p></li><li><p><span><b class="command">transfer dump &lt;dump name&gt; &lt;controller
            name&gt;</b></span>: Transfer a dump from the current controller to another
            controller. An example is <span><b class="command">transfer dump dump1
            controller2.emic.com:1090</b></span></p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="administrator_expert_commands"></a>7.5.2.&nbsp;Administrator Expert Commands</h4></div></div><div></div></div><p>Expert commands are not available by default. use the command expert on to make them available.</p><div class="itemizedlist"><ul type="disc"><li><p><span><b class="command">clone backend config &lt;backend from&gt; &lt;backend to&gt;
            &lt;url&gt; [driverPath=&lt;value&gt;] [driver=&lt;value&gt;]
            [connectionTestStatement=&lt;value&gt;]</b></span>: Clone the
            configuration of a backend in the current virtual database (this virtually
            allows to add a new backend)</p></li><li><p><span><b class="command">disable read &lt;backend name&gt;</b></span>: Disable read
            requests on a backend</p></li><li><p><span><b class="command">enable read &lt;backend name&gt;</b></span>: Enable read
            requests on a backend</p></li><li><p><span><b class="command">force checkpoint &lt;backend name&gt; &lt;checkpoint
            name&gt;</b></span>: Force the last know checkpoint of a disabled
            backend</p></li><li><p><span><b class="command">force disable &lt;backend name | *&gt;</b></span>: Force the
            disabling of a backend without storing any checkpoints. The backend will not be
            in a consistent state after this operation! (* means that all backends of this
            virtual database must be disabled by force)</p></li><li><p><span><b class="command">force enable &lt;backend name | *&gt;</b></span>: Force the
            enabling of a backend without checking for checkpoints. This command can break
            the cluster consistency, only use it if you know what you are doing! (* means that
            all backends of this virtual database must be enabled by force)</p></li><li><p><span><b class="command">force path &lt;dump name&gt; &lt;new path&gt;</b></span>:
            Update the path of the dump</p></li><li><p><span><b class="command">get backend schema &lt;backend name&gt; &lt;file
            name&gt;</b></span>: Display backend schema or save it to a file</p></li><li><p><span><b class="command">purge log &lt;checkpoint name&gt;</b></span>: Purge the
            recovery log upto specified checkpoint. All the entries of the recovery log
            prior to that checkpoint will be deleted.</p></li><li><p><span><b class="command">restore log &lt;dump name&gt; &lt;controller
            name&gt;</b></span>: Copy the local recovery log from the specified checkpoint
            onto the specified remote controller. All previous recovery log content on the
            remote controller will be erased.</p></li><li><p><span><b class="command">show checkpoints</b></span>: Show all checkpoints available in
            the recovery log.</p></li><li><p><span><b class="command">transfer backend &lt;backend name&gt; &lt;controller jmx
            address&gt;</b></span>: Transfer a backend from a controller to an other
            controller</p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="automated_backup_with_jmx"></a>7.6.&nbsp;Automated Backup With Jmx</h3></div></div><div></div></div><p>Marc Wick has given an example of a cron file to do a daily backup using the jmx connector in C-JDBC.
	The complete sources can be found in the example file:DBBackup.java in the jmx directory 
	of the examples.
	</p><pre class="programlisting">
    JMXServiceURL address = new JMXServiceURL("rmi", host, 0, "/jndi/jrmp");

    Map environment = new HashMap();
    environment.put(Context.INITIAL_CONTEXT_FACTORY,
        "com.sun.jndi.rmi.registry.RegistryContextFactory");
    environment.put(Context.PROVIDER_URL, "rmi://" + host + ":" + port);
    environment.put(JMXConnector.CREDENTIALS, PasswordAuthenticator
        .createCredentials("jmxuser", "jmxpassword"));

    JMXConnector connector = JMXConnectorFactory.connect(address, environment);
    ObjectName db = JmxConstants.getVirtualDbObjectName("databaseName");

    ...
    
    MBeanServerConnection delegateConnection = connector
        .getMBeanServerConnection(subj);

    // we create a proxy to the virtual database
    VirtualDatabaseMBean proxy = (VirtualDatabaseMBean) MBeanServerInvocationHandler
        .newProxyInstance(delegateConnection, db, VirtualDatabaseMBean.class,
            false);

    SimpleDateFormat fmt = new SimpleDateFormat("yyyy_MM_dd");
    String checkpointName = fmt.format(new Date());

    // we disable the backend and set a checkpoint
    proxy.disableBackendForCheckpoint("node1", checkpointName);

    // we call the database specific backup tool for the backup
    runDatabaseBackupTool();

    // we enable the backend again
    proxy.enableBackend("node1");
	</pre><p>The runDatabaseBackupTool() method is completely open and can call 
	any external program (like pg_dump, mysql_dump...)
	</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td valign="top" align="center" rowspan="2" width="25"><img alt="[Note]" src="../../images/note.gif"></td><th align="left">Note</th></tr><tr><td valign="top" align="left" colspan="2"><p>This method does not use octopus and as a consequence, the generated 
	backup cannot be restored on a a different database vendor than the one 
	it was issued from.
	As a great benefit though, the backup process will gain in speed, and 
	the metadata will be completely conformed to that database vendor.
	</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="recovering_from_a_failed_controller_in_distributed_mode"></a>7.7.&nbsp;Recoverying from a failed controller in distributed mode</h3></div></div><div></div></div><p> In a distributed controller configuration, when a controller goes down, here is
        the list of action to take to recover the failed controller: </p><div class="itemizedlist"><ul type="disc"><li><p>If the controller does not have any dump available, connect to a
          controller that has database dumps and use the <span><b class="command">transfer dump</b></span>
          command to copy the dump to the recovering controller.</p></li><li><p>During its failure, the recovery log of the controller missed
          queries that were executed by the cluster and it is therefore necessary to
          re-synchronize its recovery log. This can be achieve using the <span><b class="command">recover
          log</b></span> from the same controller you used to transfer the dump.</p></li><li><p>Once the previous operations are completed, you can safely
          restore the dump on the backends attached to the controller. Then, enabling the
          backends will resynchronize them with the other nodes of the cluster.</p></li></ul></div></div></div><div class="navfooter"><hr><table summary="Navigation footer" width="100%"><tr><td align="left" width="40%"><a accesskey="p" href="ar01s06.html"><img src="../../images/prev.gif" alt="Prev"></a>&nbsp;</td><td align="center" width="20%"><a accesskey="u" href="index.html"><img src="../../images/up.gif" alt="Up"></a></td><td align="right" width="40%">&nbsp;<a accesskey="n" href="ar01s08.html"><img src="../../images/next.gif" alt="Next"></a></td></tr><tr><td valign="top" align="left" width="40%">6.&nbsp;C-JDBC controller&nbsp;</td><td align="center" width="20%"><a accesskey="h" href="index.html"><img src="../../images/home.gif" alt="Home"></a></td><td valign="top" align="right" width="40%">&nbsp;8.&nbsp;Virtual Database Console Menu</td></tr></table></div></body></html>